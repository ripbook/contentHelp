<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIPBOOK CONTENT HELP</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Mukta+Malar:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --bunny-color: #9b59b6;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
        }

        body {
            font-family: 'Poppins', 'Mukta Malar', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
        }

        .container { max-width: 1200px; width: 100%; }
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 { color: var(--primary-color); font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }

        .card {
            background: var(--card-bg); border-radius: 12px; padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); transition: transform 0.3s ease;
            display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-5px); }
        .card h2 { font-size: 1.1rem; color: var(--primary-color); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }

        .content-box {
            font-size: 0.85rem; color: #666; margin: 15px 0; background: #f9f9f9;
            padding: 12px; border-radius: 8px; border-left: 4px solid var(--accent-color);
            min-height: 45px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;
        }

        .btn {
            background-color: var(--accent-color); color: white; border: none; padding: 12px;
            border-radius: 6px; cursor: pointer; font-weight: 600; display: flex;
            align-items: center; justify-content: center; gap: 8px; transition: 0.3s; width: 100%; margin-top: auto;
        }
        .btn:hover { opacity: 0.9; }

        .converter-input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; box-sizing: border-box; }

        /* Modal Base Styles */
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.95);
            z-index: 9999; overflow-y: auto; padding: 40px 20px;
        }
        .editor-content {
            background: #121212; width: 1320px; margin: auto;
            border-radius: 20px; padding: 30px; position: relative; color: white;
            display: flex; flex-direction: column; align-items: center;
        }
        .close-btn { position: absolute; right: 20px; top: 20px; background: #e74c3c; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; }

        /* Thumbnail Specifics */
        #canvas-container {
            width: 1280px; height: 720px; position: relative; background: #000;
            overflow: hidden; border: 1px solid #444; transform: scale(0.65);
            transform-origin: top center; margin-bottom: -220px;
        }
        #photo-window { position: absolute; top: 20px; left: 52px; width: 393px; height: 700px; z-index: 1; overflow: hidden; }
        #photo-display { width: 100%; height: 100%; cursor: move; position: absolute; background-size: cover; background-position: center; }
        #background-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://eaglenithu.github.io/Documents/Livebg3.png'); background-size: 100% 100%; z-index: 2; pointer-events: none; }
        
        /* UPDATED: Draggable text now supports center alignment */
        .draggable-text { 
            position: absolute; 
            cursor: move; 
            z-index: 3; 
            white-space: normal; 
            color: white; 
            text-shadow: 2px 2px 4px #000; 
            font-weight: bold; 
            text-align: center; 
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
            line-height: 1.2;
        }

        /* Crop Editor */
        .crop-canvas-area { background: #000; line-height: 0; margin: 20px 0; }
        
        .wm-toggle-bar { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 400px; }
        .wm-opt { flex: 1; padding: 10px; border: 1px solid #444; background: #222; color: #fff; cursor: pointer; border-radius: 5px; font-weight: 600; }
        .wm-opt.active { background: var(--accent-color); border-color: var(--accent-color); }

        .ui-panel { background: #222; padding: 20px; border-radius: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 950px; margin-top: 20px; }
        .input-group { display: flex; flex-direction: column; gap: 5px; background: #2d2d2d; padding: 10px; border-radius: 5px; }
        .input-group label { font-size: 11px; color: #aaa; text-transform: uppercase; }
        .input-group input { padding: 8px; background: #333; color: white; border: 1px solid #444; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header"><h1>RIPBOOK CONTENT HELP</h1></div>

    <div class="grid">
        <div class="card">
            <h2><i class="fas fa-file-alt"></i> Obituary End</h2>
            <div id="text1" class="content-box" data-fulltext="RIPBOOK ஊடாக இவ் அறிவித்தலை உற்றார், உறவினர், நண்பர்கள் அனைவரும் ஏற்றுக்கொள்ளுமாறு கேட்டுக்கொள்ளப்படுகின்றீர்கள்.">
                RIPBOOK ஊடாக இவ் அறிவித்தலை உற்றார், உறவினர், நண்பர்கள் அனைவரும்...
            </div>
            <button class="btn" onclick="copyText('text1', 'Obituary text copied!')"><i class="far fa-copy"></i> Copy Text</button>
        </div>

        <div class="card">
            <h2><i class="fas fa-video"></i> Live Content</h2>
            <div id="text2" class="content-box" data-fulltext="Live streaming- (RIPBOOK சார்பாக இறுதிக்கிரியை நேரடி ஒளிபரப்பு செய்யப்படும்).">
                Live streaming- (RIPBOOK சார்பாக இறுதிக்கிரியை நேரடி ஒளிபரப்பு செய்யப்படும்).
            </div>
            <button class="btn" onclick="copyText('text2', 'Live content copied!')"><i class="far fa-copy"></i> Copy Text</button>
        </div>

        <div class="card">
            <h2><i class="fas fa-paintbrush"></i> Create Thumbnail</h2>
            <div class="content-box">You can create the thumbnail for a YouTube live stream here..</div>
            <button class="btn" style="background-color: #f39c12;" onclick="openModal('thumbModal')"><i class="fas fa-magic"></i> Thumnail Editor</button>
        </div>

        <div class="card">
            <h2><i class="fas fa-crop-alt"></i> Photo Crop & WM</h2>
            <div class="content-box">Obituary memorial page watermark cropper (246x266).</div>
            <button class="btn" style="background-color: #2ecc71;" onclick="openModal('cropModal')"><i class="fas fa-expand"></i> Photo Cropper</button>
        </div>

        <div class="card">
            <h2><i class="fab fa-youtube"></i> YouTube Live Converter</h2>
            <input type="text" id="inputLink" class="converter-input" placeholder="Paste YouTube /live/ link">
            <button class="btn" style="background-color: #e74c3c;" onclick="convertYouTube()"><i class="fas fa-sync"></i> Convert Link</button>
        </div>

        <div class="card">
            <h2><i class="fas fa-rabbit"></i> Bunny video Converter</h2>
            <input type="text" id="bunnyInput" class="converter-input" placeholder="Paste Bunny .m3u8 link">
            <button class="btn" style="background-color: var(--bunny-color);" onclick="convertBunny()"><i class="fas fa-play-circle"></i> To MP4 Link</button>
        </div>
    </div>
</div>

<div id="thumbModal" class="modal">
    <div class="editor-content">
        <button class="close-btn" onclick="closeModal('thumbModal')">CLOSE ✕</button>
        <h2>Live Thumbnail Designer (1280x720)</h2>
        <div id="canvas-container">
            <div id="photo-window"><div id="photo-display"></div></div>
            <div id="background-layer"></div>
            
            <div id="name-box" class="draggable-text" contenteditable="true" style="top:150px; left:480px; width:750px; min-height:100px; font-size:38px;">திரு சோமசுந்தரம் சுப்பிரமணியம்</div>
            <div id="date-box" class="draggable-text" contenteditable="true" style="top:435px; left:515px; width:300px; font-size:32px;">02-02-2026</div>
            <div id="time-box" class="draggable-text" contenteditable="true" style="top:435px; left:870px; width:300px; font-size:32px;">- 08:30 AM -</div>
        </div>
        <div class="ui-panel">
            <div class="input-group"><label>Upload Photo</label><input type="file" id="thumb-upload"></div>
            <div class="input-group"><label>Photo Zoom</label><input type="range" id="zoom-photo" min="100" max="400" value="100"></div>
            <div class="input-group"><label>Name Font Size</label><input type="range" id="size-name" min="10" max="100" value="38"></div>
            <div class="input-group"><label>Date</label><input type="date" id="input-date"></div>
            <div class="input-group"><label>Time</label><input type="time" id="input-time"></div>
            <button onclick="resetTextPositions()" style="background:#c0392b; color:white; border:none; padding:10px; cursor:pointer; font-weight:bold; border-radius:5px;">RESET POSITIONS</button>
            <button onclick="downloadThumbnail()" style="grid-column: span 3; background:#27ae60; color:white; border:none; padding:15px; cursor:pointer; font-size:18px; font-weight:bold; border-radius:5px; margin-top:10px;">DOWNLOAD FINAL THUMBNAIL</button>
        </div>
    </div>
</div>

<div id="cropModal" class="modal">
    <div class="editor-content">
        <button class="close-btn" onclick="closeModal('cropModal')">CLOSE ✕</button>
        <h2>RIPBOOK PHOTO CROPPER(246x266)</h2>
        <div class="crop-canvas-area">
            <canvas id="cropCanvas" width="246" height="266"></canvas>
        </div>
        <div class="wm-toggle-bar">
            <button id="btnGrey" class="wm-opt active">Grey Watermark</button>
            <button id="btnWhite" class="wm-opt">White Watermark</button>
        </div>
        <div class="ui-panel" style="width: 500px; grid-template-columns: 1fr;">
            <div class="input-group"><label>1. Upload Portrait</label><input type="file" id="crop-upload"></div>
            <button class="btn" style="background-color: #27ae60; padding:15px; font-size: 16px;" onclick="saveBothFiles()">
                <i class="fas fa-download"></i> SAVE BOTH (CLEAN + WATERMARKED)
            </button>
        </div>
    </div>
</div>

<script>
    function openModal(id) { document.getElementById(id).style.display = 'block'; document.body.style.overflow = 'hidden'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; document.body.style.overflow = 'auto'; }

    function copyText(id, msg) {
        const txt = document.getElementById(id).getAttribute('data-fulltext');
        navigator.clipboard.writeText(txt).then(() => {
            Swal.fire({ icon: 'success', title: 'Copied!', text: msg, timer: 1500, showConfirmButton: false, toast: true, position: 'top-end' });
        });
    }

    function convertYouTube() {
        const input = document.getElementById("inputLink");
        const val = input.value.trim();
        if (!val) { Swal.fire('Error', 'Please paste a YouTube Live link first', 'error'); return; }
        const m = val.match(/\/live\/([a-zA-Z0-9_-]+)/);
        if (m) { 
            const finalLink = "https://www.youtube.com/watch?v=" + m[1];
            navigator.clipboard.writeText(finalLink).then(() => { Swal.fire('Success', 'Standard link copied!', 'success'); });
        } else { Swal.fire('Error', 'Invalid YouTube Live URL format', 'error'); }
    }

    function convertBunny() {
        const input = document.getElementById("bunnyInput");
        const val = input.value.trim();
        if (!val) { Swal.fire('Empty Field', 'Please paste a Bunny .m3u8 link first.', 'error'); return; }
        if (val.includes("playlist.m3u8")) {
            const mp4Link = val.replace("playlist.m3u8", "play_720p.mp4");
            navigator.clipboard.writeText(mp4Link).then(() => {
                Swal.fire({ icon: 'success', title: 'Converted!', text: 'MP4 link copied to clipboard.', timer: 2000, showConfirmButton: false });
            });
        } else { Swal.fire('Invalid Link', 'This is not a valid Bunny .m3u8 playlist.', 'warning'); }
    }

    // Fabric.js Cropper Logic
    const cropCanvas = new fabric.Canvas('cropCanvas', { preserveObjectStacking: true });
    const logoGrey = 'https://eaglenithu.github.io/ripbookcontenthelp/RIP_Watermark1.png';
    const logoWhite = 'https://eaglenithu.github.io/ripbookcontenthelp/RIP_Watermark2.png';
    let activeWM = null, uploadedCropImg = null;

    document.getElementById('crop-upload').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function(f) {
            fabric.Image.fromURL(f.target.result, function(img) {
                if(uploadedCropImg) cropCanvas.remove(uploadedCropImg);
                uploadedCropImg = img;
                img.scaleToWidth(246);
                cropCanvas.add(img).sendToBack(img);
                cropCanvas.centerObject(img);
                if(!activeWM) addWM(logoGrey);
                cropCanvas.setActiveObject(img).renderAll();
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function addWM(url) {
        let p = activeWM ? { left: activeWM.left, top: activeWM.top, scaleX: activeWM.scaleX, scaleY: activeWM.scaleY } : { left: 50, top: 150, scaleX: 0.04, scaleY: 0.04 };
        if (activeWM) cropCanvas.remove(activeWM);
        fabric.Image.fromURL(url, function(img) {
            img.set({ ...p, cornerColor: '#3498db', cornerSize: 8 });
            activeWM = img; cropCanvas.add(img).bringToFront(img).renderAll();
        }, { crossOrigin: 'anonymous' });
    }

    document.getElementById('btnGrey').onclick = function() { addWM(logoGrey); this.classList.add('active'); document.getElementById('btnWhite').classList.remove('active'); };
    document.getElementById('btnWhite').onclick = function() { addWM(logoWhite); this.classList.add('active'); document.getElementById('btnGrey').classList.remove('active'); };

    function saveBothFiles() {
        if(!uploadedCropImg) return Swal.fire('Error', 'Upload photo first', 'warning');
        cropCanvas.discardActiveObject().renderAll();
        const a1 = document.createElement('a'); a1.download = 'ripbook_watermarked.png'; a1.href = cropCanvas.toDataURL(); a1.click();
        setTimeout(() => {
            activeWM.visible = false; cropCanvas.renderAll();
            const a2 = document.createElement('a'); a2.download = 'ripbook_clean.png'; a2.href = cropCanvas.toDataURL(); a2.click();
            activeWM.visible = true; cropCanvas.renderAll();
            Swal.fire('Success', 'Both versions saved!', 'success');
        }, 800);
    }

    // Thumbnail Designer Logic
    const thumbDisplay = document.getElementById('photo-display');
    const nameBox = document.getElementById('name-box'), dateBox = document.getElementById('date-box'), timeBox = document.getElementById('time-box');

    document.getElementById('thumb-upload').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = (ev) => { thumbDisplay.style.backgroundImage = `url(${ev.target.result})`; };
        reader.readAsDataURL(e.target.files[0]);
    };

    document.getElementById('zoom-photo').oninput = (e) => { thumbDisplay.style.backgroundSize = `${e.target.value}%`; };
    document.getElementById('size-name').oninput = (e) => { nameBox.style.fontSize = e.target.value + "px"; };
    document.getElementById('input-date').onchange = (e) => { const [y,m,d] = e.target.value.split('-'); dateBox.innerText = `${d}-${m}-${y}`; };
    document.getElementById('input-time').onchange = (e) => {
        let [h, m] = e.target.value.split(':');
        let ampm = h >= 12 ? 'PM' : 'AM'; h = h % 12 || 12;
        timeBox.innerText = `- ${h}:${m} ${ampm} -`;
    };

    function resetTextPositions() {
        nameBox.style.top = "150px"; nameBox.style.left = "480px"; nameBox.style.fontSize = "38px";
        dateBox.style.top = "435px"; dateBox.style.left = "515px";
        timeBox.style.top = "435px"; timeBox.style.left = "870px";
    }

    function makeDraggable(el) {
        let p1, p2, p3, p4;
        el.onmousedown = (e) => {
            if (e.target.contentEditable === "true" && e.target === document.activeElement) return;
            p3 = e.clientX; p4 = e.clientY;
            document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
            document.onmousemove = (e) => {
                p1 = p3 - e.clientX; p2 = p4 - e.clientY; p3 = e.clientX; p4 = e.clientY;
                el.style.top = (el.offsetTop - p2) + "px"; el.style.left = (el.offsetLeft - p1) + "px";
            };
        };
    }
    makeDraggable(nameBox); makeDraggable(dateBox); makeDraggable(timeBox); makeDraggable(thumbDisplay);

    function downloadThumbnail() {
        document.activeElement.blur();
        html2canvas(document.getElementById('canvas-container'), { useCORS: true, scale: 2 }).then(cvs => {
            const link = document.createElement('a'); link.download = 'RIPBOOK_Thumbnail.png'; link.href = cvs.toDataURL(); link.click();
        });
    }
</script>

</body>
</html>
